{"remainingRequest":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/babel-loader/lib/index.js!/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/src/components/sys/basic/PermissMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/src/components/sys/basic/PermissMana.vue","mtime":1625467519759},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlBlcm1pc3NNYW5hIiwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcm9sZTogewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIG5hbWVaaDogJycKICAgICAgfSwKICAgICAgYWN0aXZlTmFtZTogLTEsCiAgICAgIHJvbGVzOiBbXSwKICAgICAgZGVmYXVsdFByb3BzOiB7CiAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicsCiAgICAgICAgbGFiZWw6ICduYW1lJwogICAgICB9LAoKICAgICAgLyrlkI7nq6/kvKDmnaXnmoToj5zljZXmlL7lnKhhbGxtZW51c+mHjOmdoiovCiAgICAgIGFsbG1lbnVzOiBbXSwKICAgICAgc2VsZWN0ZWRNZW51czogW10KICAgIH07CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdGhpcy5pbml0Um9sZXMoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXRSb2xlczogZnVuY3Rpb24gaW5pdFJvbGVzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdGhpcy5nZXRSZXF1ZXN0KCIvc3lzdGVtL2Jhc2ljL3Blcm1pc3MvIikudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIGlmIChyZXNwKSB7CiAgICAgICAgICBfdGhpcy5yb2xlcyA9IHJlc3A7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBkb0FkZFJvbGU6IGZ1bmN0aW9uIGRvQWRkUm9sZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBpZiAodGhpcy5yb2xlLm5hbWUgJiYgdGhpcy5yb2xlLm5hbWVaaCkgewogICAgICAgIHRoaXMucG9zdFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzcy9yb2xlIiwgdGhpcy5yb2xlKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgICBfdGhpczIucm9sZS5uYW1lWmggPSAnJzsKICAgICAgICAgICAgX3RoaXMyLnJvbGUubmFtZSA9ICcnOwoKICAgICAgICAgICAgX3RoaXMyLmluaXRSb2xlcygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIua3u+WKoOaVsOaNruS4jeWPr+S7peS4uuepuu+8gSIpOwogICAgICB9CiAgICB9LAogICAgY2hhbmdlOiBmdW5jdGlvbiBjaGFuZ2UocmlkKSB7CiAgICAgIGlmIChyaWQpIHsKICAgICAgICB0aGlzLmluaXRBbGxNZW51cygpOwogICAgICAgIHRoaXMuaW5pdFNlbGVjdGVkTWVudXMocmlkKTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZVJvbGU6IGZ1bmN0aW9uIGRlbGV0ZVJvbGUocm9sZSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuJGNvbmZpcm0oJ+atpOaTjeS9nOWwhuawuOS5heWIoOmZpOOAkCcgKyByb2xlLm5hbWVaaCArICfjgJHop5LoibIsIOaYr+WQpue7p+e7rT8nLCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzLmRlbGV0ZVJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzcy9yb2xlLyIgKyByb2xlLmlkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgICBfdGhpczMuaW5pdFJvbGVzKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczMuJG1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ2luZm8nLAogICAgICAgICAgbWVzc2FnZTogJ+W3suWPlua2iOWIoOmZpCcKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgY2FuY2VsVXBkYXRlOiBmdW5jdGlvbiBjYW5jZWxVcGRhdGUoKSB7CiAgICAgIC8q5Y+W5raI5L+u5pS55pe255u05o6l5pS26LW36Z2i5p2/Ki8KICAgICAgdGhpcy5hY3RpdmVOYW1lID0gLTE7CiAgICB9LAogICAgZG9VcGRhdGU6IGZ1bmN0aW9uIGRvVXBkYXRlKHJpZCwgaW5kZXgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgdHJlZSA9IHRoaXMuJHJlZnMudHJlZVtpbmRleF07CiAgICAgIHZhciBzZWxlY3RlZEtleXMgPSB0cmVlLmdldENoZWNrZWRLZXlzKHRydWUpOwogICAgICB2YXIgdXJsID0gJy9zeXN0ZW0vYmFzaWMvcGVybWlzcy8/cmlkPScgKyByaWQ7CiAgICAgIHNlbGVjdGVkS2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB1cmwgKz0gJyZtaWRzPScgKyBrZXk7CiAgICAgIH0pOwogICAgICB0aGlzLnB1dFJlcXVlc3QodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZyh1cmwpCiAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgIC8q5pu05paw5a6M5LmL5ZCO5bCx6KaB5pS26LW36Z2i5p2/Ki8KICAgICAgICAgIF90aGlzNC5hY3RpdmVOYW1lID0gLTE7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBpbml0QWxsTWVudXM6IGZ1bmN0aW9uIGluaXRBbGxNZW51cygpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzcy9tZW51cyIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgX3RoaXM1LmFsbG1lbnVzID0gcmVzcDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGluaXRTZWxlY3RlZE1lbnVzOiBmdW5jdGlvbiBpbml0U2VsZWN0ZWRNZW51cyhyaWQpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzcy9taWRzLyIgKyByaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgX3RoaXM2LnNlbGVjdGVkTWVudXMgPSByZXNwOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n<!--    添加区域-->\n    <div class=\"permissManaAdd\">\n      <el-input size=\"small\" placeholder=\"请输入角色英文名\" style=\"width: 300px;margin-right: 8px\"\n                v-model=\"role.name\">\n<!--        前缀-->\n        <template slot=\"prepend\">ROLE_</template>\n      </el-input>\n      <el-input size=\"small\" placeholder=\"请输入角色中文名\" style=\"width: 300px;margin-right: 8px\"\n                v-model=\"role.nameZh\"\n                @keydown.enter.native=\"doAddRole\"></el-input>\n      <el-button size=\"small\" type=\"primary\" icon=\"el-icon-plus\" @click=\"doAddRole\">添加角色</el-button>\n    </div>\n<!--显示区域-->\n    <div class=\"permissManaShow\">\n      <!--                   accordion表示手风琴效果,activeName表示是哪一个id展开，选项卡的id就是name-->\n<!--      @change=\"change\"表示当前面板改变时触发-->\n      <el-collapse v-model=\"activeName\"\n                   accordion\n                   @change=\"change\">\n        <el-collapse-item :title=\"r.nameZh\" :name=\"r.id\" v-for=\"(r,index) in roles\" :key=\"index\">\n          <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n<!--              可访问的资源表示这个角色可以访问的菜单，一级菜单和二级菜单放在了tree控件了里面-->\n              <span>可访问的资源</span>\n<!--              这个删除按钮表示删除这个角色-->\n              <el-button style=\"float: right; padding: 3px 0;color: #ff0000;\" icon=\"el-icon-delete\"\n                         type=\"text\" @click=\"deleteRole(r)\"></el-button>\n            </div>\n            <div>\n<!--              树形控件-->\n<!--              ”所有“是菜单表中的第一个，id=1，所有的一级菜单的parentId就是1-->\n<!--              :default-checked-keys表示选择框selectedMenus数组中包含的项前面选中-->\n<!--              node-key表示菜单项的id，作为预选中的参数-->\n<!--              ref=\"tree\"表示通过这个名字就可以查找到这个tree,这里是一个tree数组，有多少个角色就有多少个tree-->\n<!--              :key表示区分每一个tree的标志，这样加载tree下面的选择框的时候就不会去加载同意俄格tree的-->\n              <el-tree show-checkbox\n                       node-key=\"id\"\n                       ref=\"tree\"\n                       :key=\"index\"\n                       :default-checked-keys=\"selectedMenus\"\n                       :data=\"allmenus\"\n                       :props=\"defaultProps\">\n              </el-tree>\n              <div style=\"display: flex;justify-content: flex-end\">\n                <el-button @click=\"cancelUpdate\" style=\"margin-top: 8px\">取消修改</el-button>\n                <el-button type=\"primary\" style=\"margin-top: 8px\" @click=\"doUpdate(r.id,index)\">确认修改</el-button>\n              </div>\n            </div>\n          </el-card>\n        </el-collapse-item>\n      </el-collapse>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"PermissMana\",\n  data(){\n    return{\n      role:{\n        name:'',\n        nameZh:'',\n      },\n      activeName:-1,\n      roles:[],\n      defaultProps:{\n        children: 'children',\n        label: 'name'\n      },\n      /*后端传来的菜单放在allmenus里面*/\n      allmenus:[],\n      selectedMenus: [],\n    }\n  },\n  mounted() {\n    this.initRoles();\n  },\n  methods:{\n    initRoles(){\n      this.getRequest(\"/system/basic/permiss/\").then(resp => {\n        if(resp){\n          this.roles = resp;\n        }\n      })\n    },\n    doAddRole(){\n      if(this.role.name && this.role.nameZh){\n        this.postRequest(\"/system/basic/permiss/role\", this.role).then(resp => {\n          if(resp){\n            this.role.nameZh = '';\n            this.role.name = '';\n            this.initRoles();\n          }\n        })\n      }else{\n        this.$message.error(\"添加数据不可以为空！\");\n      }\n    },\n    change(rid){\n      if (rid) {\n        this.initAllMenus();\n        this.initSelectedMenus(rid);\n      }\n    },\n    deleteRole(role){\n      this.$confirm('此操作将永久删除【' + role.nameZh + '】角色, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.deleteRequest(\"/system/basic/permiss/role/\" + role.id).then(resp => {\n          if (resp) {\n            this.initRoles();\n          }\n        })\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n    cancelUpdate(){\n      /*取消修改时直接收起面板*/\n      this.activeName = -1;\n    },\n    doUpdate(rid, index){\n      let tree = this.$refs.tree[index];\n      let selectedKeys = tree.getCheckedKeys(true);\n      let url = '/system/basic/permiss/?rid=' + rid;\n      selectedKeys.forEach(key => {\n        url += '&mids=' + key;\n      })\n      this.putRequest(url).then(resp => {\n        //console.log(url)\n        if (resp) {\n          /*更新完之后就要收起面板*/\n          this.activeName = -1;\n        }\n      })\n    },\n    initAllMenus(){\n      this.getRequest(\"/system/basic/permiss/menus\").then(resp => {\n        if (resp) {\n          this.allmenus = resp;\n        }\n      })\n    },\n    initSelectedMenus(rid){\n      this.getRequest(\"/system/basic/permiss/mids/\" + rid).then(resp => {\n        if (resp) {\n          this.selectedMenus = resp;\n        }\n      })\n    },\n  }\n}\n</script>\n\n<style scoped>\n.permissManaAdd{\n  display: flex;\n  justify-content: flex-start;\n}\n.permissManaShow{\n  margin-top: 10px;\n  width: 700px;\n}\n</style>"],"sourceRoot":"src/components/sys/basic"}]}