{"remainingRequest":"D:\\vuehr\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vuehr\\src\\components\\sys\\basic\\PermissMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vuehr\\src\\components\\sys\\basic\\PermissMana.vue","mtime":1608390329296},{"path":"D:\\vuehr\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vuehr\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\vuehr\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vuehr\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJQZXJtaXNzTWFuYSIsDQogIGRhdGEoKXsNCiAgICByZXR1cm57DQogICAgICByb2xlOnsNCiAgICAgICAgbmFtZTonJywNCiAgICAgICAgbmFtZVpoOicnLA0KICAgICAgfSwNCiAgICAgIGFjdGl2ZU5hbWU6LTEsDQogICAgICByb2xlczpbXSwNCiAgICAgIGRlZmF1bHRQcm9wczp7DQogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLA0KICAgICAgICBsYWJlbDogJ25hbWUnDQogICAgICB9LA0KICAgICAgLyrlkI7nq6/kvKDmnaXnmoToj5zljZXmlL7lnKhhbGxtZW51c+mHjOmdoiovDQogICAgICBhbGxtZW51czpbXSwNCiAgICAgIHNlbGVjdGVkTWVudXM6IFtdLA0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmluaXRSb2xlcygpOw0KICB9LA0KICBtZXRob2RzOnsNCiAgICBpbml0Um9sZXMoKXsNCiAgICAgIHRoaXMuZ2V0UmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzLyIpLnRoZW4ocmVzcCA9PiB7DQogICAgICAgIGlmKHJlc3Apew0KICAgICAgICAgIHRoaXMucm9sZXMgPSByZXNwOw0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgZG9BZGRSb2xlKCl7DQogICAgICBpZih0aGlzLnJvbGUubmFtZSAmJiB0aGlzLnJvbGUubmFtZVpoKXsNCiAgICAgICAgdGhpcy5wb3N0UmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzL3JvbGUiLCB0aGlzLnJvbGUpLnRoZW4ocmVzcCA9PiB7DQogICAgICAgICAgaWYocmVzcCl7DQogICAgICAgICAgICB0aGlzLnJvbGUubmFtZVpoID0gJyc7DQogICAgICAgICAgICB0aGlzLnJvbGUubmFtZSA9ICcnOw0KICAgICAgICAgICAgdGhpcy5pbml0Um9sZXMoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICB9ZWxzZXsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5re75Yqg5pWw5o2u5LiN5Y+v5Lul5Li656m677yBIik7DQogICAgICB9DQogICAgfSwNCiAgICBjaGFuZ2UocmlkKXsNCiAgICAgIGlmIChyaWQpIHsNCiAgICAgICAgdGhpcy5pbml0QWxsTWVudXMoKTsNCiAgICAgICAgdGhpcy5pbml0U2VsZWN0ZWRNZW51cyhyaWQpOw0KICAgICAgfQ0KICAgIH0sDQogICAgZGVsZXRlUm9sZShyb2xlKXsNCiAgICAgIHRoaXMuJGNvbmZpcm0oJ+atpOaTjeS9nOWwhuawuOS5heWIoOmZpOOAkCcgKyByb2xlLm5hbWVaaCArICfjgJHop5LoibIsIOaYr+WQpue7p+e7rT8nLCAn5o+Q56S6Jywgew0KICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsDQogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLA0KICAgICAgICB0eXBlOiAnd2FybmluZycNCiAgICAgIH0pLnRoZW4oKCkgPT4gew0KICAgICAgICB0aGlzLmRlbGV0ZVJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzcy9yb2xlLyIgKyByb2xlLmlkKS50aGVuKHJlc3AgPT4gew0KICAgICAgICAgIGlmIChyZXNwKSB7DQogICAgICAgICAgICB0aGlzLmluaXRSb2xlcygpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0pLmNhdGNoKCgpID0+IHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZSh7DQogICAgICAgICAgdHlwZTogJ2luZm8nLA0KICAgICAgICAgIG1lc3NhZ2U6ICflt7Llj5bmtojliKDpmaQnDQogICAgICAgIH0pOw0KICAgICAgfSk7DQogICAgfSwNCiAgICBjYW5jZWxVcGRhdGUoKXsNCiAgICAgIC8q5Y+W5raI5L+u5pS55pe255u05o6l5pS26LW36Z2i5p2/Ki8NCiAgICAgIHRoaXMuYWN0aXZlTmFtZSA9IC0xOw0KICAgIH0sDQogICAgZG9VcGRhdGUocmlkLCBpbmRleCl7DQogICAgICBsZXQgdHJlZSA9IHRoaXMuJHJlZnMudHJlZVtpbmRleF07DQogICAgICBsZXQgc2VsZWN0ZWRLZXlzID0gdHJlZS5nZXRDaGVja2VkS2V5cyh0cnVlKTsNCiAgICAgIGxldCB1cmwgPSAnL3N5c3RlbS9iYXNpYy9wZXJtaXNzLz9yaWQ9JyArIHJpZDsNCiAgICAgIHNlbGVjdGVkS2V5cy5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgIHVybCArPSAnJm1pZHM9JyArIGtleTsNCiAgICAgIH0pDQogICAgICB0aGlzLnB1dFJlcXVlc3QodXJsKS50aGVuKHJlc3AgPT4gew0KICAgICAgICAvL2NvbnNvbGUubG9nKHVybCkNCiAgICAgICAgaWYgKHJlc3ApIHsNCiAgICAgICAgICAvKuabtOaWsOWujOS5i+WQjuWwseimgeaUtui1t+mdouadvyovDQogICAgICAgICAgdGhpcy5hY3RpdmVOYW1lID0gLTE7DQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICBpbml0QWxsTWVudXMoKXsNCiAgICAgIHRoaXMuZ2V0UmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzL21lbnVzIikudGhlbihyZXNwID0+IHsNCiAgICAgICAgaWYgKHJlc3ApIHsNCiAgICAgICAgICB0aGlzLmFsbG1lbnVzID0gcmVzcDsNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIGluaXRTZWxlY3RlZE1lbnVzKHJpZCl7DQogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzcy9taWRzLyIgKyByaWQpLnRoZW4ocmVzcCA9PiB7DQogICAgICAgIGlmIChyZXNwKSB7DQogICAgICAgICAgdGhpcy5zZWxlY3RlZE1lbnVzID0gcmVzcDsNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICB9DQp9DQo="},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\r\n  <div>\r\n<!--    添加区域-->\r\n    <div class=\"permissManaAdd\">\r\n      <el-input size=\"small\" placeholder=\"请输入角色英文名\" style=\"width: 300px;margin-right: 8px\"\r\n                v-model=\"role.name\">\r\n<!--        前缀-->\r\n        <template slot=\"prepend\">ROLE_</template>\r\n      </el-input>\r\n      <el-input size=\"small\" placeholder=\"请输入角色中文名\" style=\"width: 300px;margin-right: 8px\"\r\n                v-model=\"role.nameZh\"\r\n                @keydown.enter.native=\"doAddRole\"></el-input>\r\n      <el-button size=\"small\" type=\"primary\" icon=\"el-icon-plus\" @click=\"doAddRole\">添加角色</el-button>\r\n    </div>\r\n<!--显示区域-->\r\n    <div class=\"permissManaShow\">\r\n      <!--                   accordion表示手风琴效果,activeName表示是哪一个id展开，选项卡的id就是name-->\r\n<!--      @change=\"change\"表示当前面板改变时触发-->\r\n      <el-collapse v-model=\"activeName\"\r\n                   accordion\r\n                   @change=\"change\">\r\n        <el-collapse-item :title=\"r.nameZh\" :name=\"r.id\" v-for=\"(r,index) in roles\" :key=\"index\">\r\n          <el-card class=\"box-card\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n<!--              可访问的资源表示这个角色可以访问的菜单，一级菜单和二级菜单放在了tree控件了里面-->\r\n              <span>可访问的资源</span>\r\n<!--              这个删除按钮表示删除这个角色-->\r\n              <el-button style=\"float: right; padding: 3px 0;color: #ff0000;\" icon=\"el-icon-delete\"\r\n                         type=\"text\" @click=\"deleteRole(r)\"></el-button>\r\n            </div>\r\n            <div>\r\n<!--              树形控件-->\r\n<!--              ”所有“是菜单表中的第一个，id=1，所有的一级菜单的parentId就是1-->\r\n<!--              :default-checked-keys表示选择框selectedMenus数组中包含的项前面选中-->\r\n<!--              node-key表示菜单项的id，作为预选中的参数-->\r\n<!--              ref=\"tree\"表示通过这个名字就可以查找到这个tree,这里是一个tree数组，有多少个角色就有多少个tree-->\r\n<!--              :key表示区分每一个tree的标志，这样加载tree下面的选择框的时候就不会去加载同意俄格tree的-->\r\n              <el-tree show-checkbox\r\n                       node-key=\"id\"\r\n                       ref=\"tree\"\r\n                       :key=\"index\"\r\n                       :default-checked-keys=\"selectedMenus\"\r\n                       :data=\"allmenus\"\r\n                       :props=\"defaultProps\">\r\n              </el-tree>\r\n              <div style=\"display: flex;justify-content: flex-end\">\r\n                <el-button @click=\"cancelUpdate\" style=\"margin-top: 8px\">取消修改</el-button>\r\n                <el-button type=\"primary\" style=\"margin-top: 8px\" @click=\"doUpdate(r.id,index)\">确认修改</el-button>\r\n              </div>\r\n            </div>\r\n          </el-card>\r\n        </el-collapse-item>\r\n      </el-collapse>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"PermissMana\",\r\n  data(){\r\n    return{\r\n      role:{\r\n        name:'',\r\n        nameZh:'',\r\n      },\r\n      activeName:-1,\r\n      roles:[],\r\n      defaultProps:{\r\n        children: 'children',\r\n        label: 'name'\r\n      },\r\n      /*后端传来的菜单放在allmenus里面*/\r\n      allmenus:[],\r\n      selectedMenus: [],\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initRoles();\r\n  },\r\n  methods:{\r\n    initRoles(){\r\n      this.getRequest(\"/system/basic/permiss/\").then(resp => {\r\n        if(resp){\r\n          this.roles = resp;\r\n        }\r\n      })\r\n    },\r\n    doAddRole(){\r\n      if(this.role.name && this.role.nameZh){\r\n        this.postRequest(\"/system/basic/permiss/role\", this.role).then(resp => {\r\n          if(resp){\r\n            this.role.nameZh = '';\r\n            this.role.name = '';\r\n            this.initRoles();\r\n          }\r\n        })\r\n      }else{\r\n        this.$message.error(\"添加数据不可以为空！\");\r\n      }\r\n    },\r\n    change(rid){\r\n      if (rid) {\r\n        this.initAllMenus();\r\n        this.initSelectedMenus(rid);\r\n      }\r\n    },\r\n    deleteRole(role){\r\n      this.$confirm('此操作将永久删除【' + role.nameZh + '】角色, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        this.deleteRequest(\"/system/basic/permiss/role/\" + role.id).then(resp => {\r\n          if (resp) {\r\n            this.initRoles();\r\n          }\r\n        })\r\n      }).catch(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: '已取消删除'\r\n        });\r\n      });\r\n    },\r\n    cancelUpdate(){\r\n      /*取消修改时直接收起面板*/\r\n      this.activeName = -1;\r\n    },\r\n    doUpdate(rid, index){\r\n      let tree = this.$refs.tree[index];\r\n      let selectedKeys = tree.getCheckedKeys(true);\r\n      let url = '/system/basic/permiss/?rid=' + rid;\r\n      selectedKeys.forEach(key => {\r\n        url += '&mids=' + key;\r\n      })\r\n      this.putRequest(url).then(resp => {\r\n        //console.log(url)\r\n        if (resp) {\r\n          /*更新完之后就要收起面板*/\r\n          this.activeName = -1;\r\n        }\r\n      })\r\n    },\r\n    initAllMenus(){\r\n      this.getRequest(\"/system/basic/permiss/menus\").then(resp => {\r\n        if (resp) {\r\n          this.allmenus = resp;\r\n        }\r\n      })\r\n    },\r\n    initSelectedMenus(rid){\r\n      this.getRequest(\"/system/basic/permiss/mids/\" + rid).then(resp => {\r\n        if (resp) {\r\n          this.selectedMenus = resp;\r\n        }\r\n      })\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.permissManaAdd{\r\n  display: flex;\r\n  justify-content: flex-start;\r\n}\r\n.permissManaShow{\r\n  margin-top: 10px;\r\n  width: 700px;\r\n}\r\n</style>"]}]}