{"remainingRequest":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/src/components/sys/basic/DepMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/src/components/sys/basic/DepMana.vue","mtime":1625467519759},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyuxiyang/Documents/gitProject/microhr/vuehr/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkRlcE1hbmEiLAogIGRhdGEoKXsKICAgIHJldHVybiB7CiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICBmaWx0ZXJUZXh0OiAnJywKICAgICAgZGVwOiB7CiAgICAgICAgbmFtZTogJycsCiAgICAgICAgcGFyZW50SWQ6IC0xCiAgICAgIH0sCiAgICAgIHBuYW1lOiAnJywKICAgICAgZGVwczogW10sCiAgICAgIGRlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiAnbmFtZScKICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuaW5pdERlcHMoKTsKICB9LAogIHdhdGNoOnsKICAgIC8q5b2T5pCc57Si5qGG5LitZmlsdGVyVGV4dOeahOWAvOWPkeeUn+WPmOWMlueahOaXtuWAme+8jOWwseS8muinpuWPkeS4i+mdoueahOaWueazlSovCiAgICBmaWx0ZXJUZXh0KHZhbCl7CiAgICAgIHRoaXMuJHJlZnMudHJlZS5maWx0ZXIodmFsKTsKICAgIH0KICB9LAogIG1ldGhvZHM6ewogICAgLyrmr4/mrKHmt7vliqDlrozlsLHmiormoYbkuK3mlbDmja7muIXnqboqLwogICAgaW5pdERlcCgpIHsKICAgICAgdGhpcy5kZXAgPSB7CiAgICAgICAgbmFtZTogJycsCiAgICAgICAgcGFyZW50SWQ6IC0xCiAgICAgIH0KICAgICAgdGhpcy5wbmFtZSA9ICcnOwogICAgfSwKICAgIGFkZERlcFRvRGVwcyhkZXBzLCBkZXApIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGQgPSBkZXBzW2ldOwogICAgICAgIGlmIChkLmlkID09IGRlcC5wYXJlbnRJZCkgewogICAgICAgICAgZC5jaGlsZHJlbiA9IGQuY2hpbGRyZW4uY29uY2F0KGRlcCk7CiAgICAgICAgICBpZiAoZC5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGQucGFyZW50ID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5hZGREZXBUb0RlcHMoZC5jaGlsZHJlbiwgZGVwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkb0FkZERlcCgpIHsKICAgICAgdGhpcy5wb3N0UmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9kZXBhcnRtZW50LyIsIHRoaXMuZGVwKS50aGVuKHJlc3AgPT4gewogICAgICAgIGlmIChyZXNwKSB7CiAgICAgICAgICAvKuWKqOaAgeWcsOW+gHRyZWXkuK3mt7vliqDkuIDkuKrmlbDmja7vvIzmt7vliqDlrozmlbTkuKp0cmVl5LiN55So5pS26LW35p2lKi8KICAgICAgICAgIHRoaXMuYWRkRGVwVG9EZXBzKHRoaXMuZGVwcywgcmVzcC5vYmopOwogICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgLy/liJ3lp4vljJblj5jph4/vvIzkvb/lr7nor53moYZpbnB1dOahhumHjOmdouaVsOaNruS4uuepugogICAgICAgICAgdGhpcy5pbml0RGVwKCk7CiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIHJlbW92ZURlcEZyb21EZXBzKHAsZGVwcywgaWQpIHsKICAgICAgZm9yKGxldCBpPTA7aTxkZXBzLmxlbmd0aDtpKyspewogICAgICAgIGxldCBkID0gZGVwc1tpXTsKICAgICAgICBpZiAoZC5pZCA9PSBpZCkgewogICAgICAgICAgZGVwcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBpZiAoZGVwcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICBwLnBhcmVudCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH1lbHNlewogICAgICAgICAgdGhpcy5yZW1vdmVEZXBGcm9tRGVwcyhkLGQuY2hpbGRyZW4sIGlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVEZXAoZGF0YSkgewogICAgICBpZiAoZGF0YS5wYXJlbnQpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLniLbpg6jpl6jliKDpmaTlpLHotKUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRjb25maXJtKCfmraTmk43kvZzlsIbmsLjkuYXliKDpmaTjgJAnICsgZGF0YS5uYW1lICsgJ+OAkemDqOmXqCwg5piv5ZCm57un57utPycsICfmj5DnpLonLCB7CiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCiAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy5kZWxldGVSZXF1ZXN0KCIvc3lzdGVtL2Jhc2ljL2RlcGFydG1lbnQvIitkYXRhLmlkKS50aGVuKHJlc3A9PnsKICAgICAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgICAgICB0aGlzLnJlbW92ZURlcEZyb21EZXBzKG51bGwsdGhpcy5kZXBzLGRhdGEuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAnaW5mbycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICflt7Llj5bmtojliKDpmaQnCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNob3dBZGREZXBWaWV3KGRhdGEpIHsKICAgICAgdGhpcy5wbmFtZSA9IGRhdGEubmFtZTsKICAgICAgdGhpcy5kZXAucGFyZW50SWQgPSBkYXRhLmlkOwogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlOwogICAgfSwKICAgIC8qZGF0YeWwseaYr+WtmOeahOS4gOadoeadoeeahGpzb27lr7nosaHvvIx2YWx1ZeWwseaYr+aQnOe0ouahhueahOWGheWuuSovCiAgICBmaWx0ZXJOb2RlKHZhbHVlLCBkYXRhKSB7CiAgICAgIGlmICghdmFsdWUpIHJldHVybiB0cnVlOwogICAgICByZXR1cm4gZGF0YS5uYW1lLmluZGV4T2YodmFsdWUpICE9PSAtMTsKICAgIH0sCiAgICBpbml0RGVwcygpewogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvZGVwYXJ0bWVudC8iKS50aGVuKHJlc3AgPT4gewogICAgICAgIGlmKHJlc3ApewogICAgICAgICAgdGhpcy5kZXBzID0gcmVzcDsKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogIH0KfQo="},{"version":3,"sources":["DepMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DepMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\n  <div style=\"width: 500px;\">\n      <el-input\n          placeholder=\"请输入部门名称进行搜索...\"\n          prefix-icon=\"el-icon-search\"\n          v-model=\"filterText\">\n      </el-input>\n\n<!--    :expand-on-click-node=\"false\"表示在添加部门或者删除部门的时候不会展开tree-->\n    <el-tree\n              style=\"margin-top: 10px\"\n              :data=\"deps\"\n              :props=\"defaultProps\"\n              :expand-on-click-node=\"false\"\n              :filter-node-method=\"filterNode\"\n              ref=\"tree\">\n      <span class=\"custom-tree-node\" style=\"display: flex;justify-content: space-between;width: 100%;\"\n          slot-scope=\"{ node, data }\">\n          <span>{{data.name }}</span>\n           <span>\n              <el-button\n                  type=\"primary\"\n                  size=\"mini\"\n                  class=\"depBtn\"\n                  @click=\"() => showAddDepView(data)\">\n                添加部门\n              </el-button>\n              <el-button\n                  type=\"danger\"\n                  size=\"mini\"\n                  class=\"depBtn\"\n                  @click=\"() => deleteDep(data)\">\n                删除部门\n              </el-button>\n          </span>\n      </span>\n    </el-tree>\n<!--    添加对话框-->\n    <el-dialog\n        title=\"添加部门\"\n        :visible.sync=\"dialogVisible\"\n        width=\"30%\">\n      <div>\n        <table>\n          <tr>\n            <td>\n              <el-tag>上级部门</el-tag>\n            </td>\n            <td>{{pname}}</td>\n          </tr>\n          <tr>\n            <td>\n              <el-tag>部门名称</el-tag>\n            </td>\n            <td>\n              <el-input v-model=\"dep.name\" placeholder=\"请输入部门名称...\"></el-input>\n            </td>\n          </tr>\n        </table>\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"doAddDep\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n\nexport default {\n  name: \"DepMana\",\n  data(){\n    return {\n      dialogVisible: false,\n      filterText: '',\n      dep: {\n        name: '',\n        parentId: -1\n      },\n      pname: '',\n      deps: [],\n      defaultProps: {\n        children: 'children',\n        label: 'name'\n      }\n    }\n  },\n  mounted() {\n    this.initDeps();\n  },\n  watch:{\n    /*当搜索框中filterText的值发生变化的时候，就会触发下面的方法*/\n    filterText(val){\n      this.$refs.tree.filter(val);\n    }\n  },\n  methods:{\n    /*每次添加完就把框中数据清空*/\n    initDep() {\n      this.dep = {\n        name: '',\n        parentId: -1\n      }\n      this.pname = '';\n    },\n    addDepToDeps(deps, dep) {\n      for (let i = 0; i < deps.length; i++) {\n        let d = deps[i];\n        if (d.id == dep.parentId) {\n          d.children = d.children.concat(dep);\n          if (d.children.length > 0) {\n            d.parent = true;\n          }\n          return;\n        } else {\n          this.addDepToDeps(d.children, dep);\n        }\n      }\n    },\n    doAddDep() {\n      this.postRequest(\"/system/basic/department/\", this.dep).then(resp => {\n        if (resp) {\n          /*动态地往tree中添加一个数据，添加完整个tree不用收起来*/\n          this.addDepToDeps(this.deps, resp.obj);\n          this.dialogVisible = false;\n\n          //初始化变量，使对话框input框里面数据为空\n          this.initDep();\n        }\n      })\n    },\n    removeDepFromDeps(p,deps, id) {\n      for(let i=0;i<deps.length;i++){\n        let d = deps[i];\n        if (d.id == id) {\n          deps.splice(i, 1);\n          if (deps.length == 0) {\n            p.parent = false;\n          }\n          return;\n        }else{\n          this.removeDepFromDeps(d,d.children, id);\n        }\n      }\n    },\n    deleteDep(data) {\n      if (data.parent) {\n        this.$message.error(\"父部门删除失败\");\n      } else {\n        this.$confirm('此操作将永久删除【' + data.name + '】部门, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          this.deleteRequest(\"/system/basic/department/\"+data.id).then(resp=>{\n            if (resp) {\n              this.removeDepFromDeps(null,this.deps,data.id);\n            }\n          })\n        }).catch(() => {\n          this.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      }\n    },\n    showAddDepView(data) {\n      this.pname = data.name;\n      this.dep.parentId = data.id;\n      this.dialogVisible = true;\n    },\n    /*data就是存的一条条的json对象，value就是搜索框的内容*/\n    filterNode(value, data) {\n      if (!value) return true;\n      return data.name.indexOf(value) !== -1;\n    },\n    initDeps(){\n      this.getRequest(\"/system/basic/department/\").then(resp => {\n        if(resp){\n          this.deps = resp;\n        }\n      })\n    },\n  }\n}\n</script>\n\n<style scoped>\n.depBtn {\n  padding: 2px;\n}\n</style>"]}]}